{"remainingRequest":"/home/lxt/SupplyChain-master/iview-admin/node_modules/babel-loader/lib/index.js!/home/lxt/SupplyChain-master/iview-admin/node_modules/eslint-loader/index.js??ref--13-0!/home/lxt/SupplyChain-master/iview-admin/src/router/index.js","dependencies":[{"path":"/home/lxt/SupplyChain-master/iview-admin/src/router/index.js","mtime":1583204240000},{"path":"/home/lxt/SupplyChain-master/iview-admin/.babelrc","mtime":1583204240000},{"path":"/home/lxt/SupplyChain-master/iview-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lxt/SupplyChain-master/iview-admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/lxt/SupplyChain-master/iview-admin/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport Vue from 'vue';\nimport Router from 'vue-router';\nimport routes from \"./routers\";\nimport store from '@/store';\nimport iView from 'iview';\nimport { setToken, getToken, canTurnTo, setTitle } from '@/libs/util';\nimport config from '@/config';\nvar homeName = config.homeName;\nVue.use(Router);\nvar router = new Router({\n  routes: routes,\n  mode: 'history'\n});\nvar LOGIN_PAGE_NAME = 'login';\n\nvar turnTo = function turnTo(to, access, next) {\n  if (canTurnTo(to.name, access, routes)) next(); // 有权限，可访问\n  else next({\n      replace: true,\n      name: 'error_401'\n    }); // 无权限，重定向到401页面\n};\n\nrouter.beforeEach(function (to, from, next) {\n  iView.LoadingBar.start();\n  var token = getToken();\n\n  if (!token && to.name !== LOGIN_PAGE_NAME) {\n    // 未登录且要跳转的页面不是登录页\n    next({\n      name: LOGIN_PAGE_NAME // 跳转到登录页\n\n    });\n  } else if (!token && to.name === LOGIN_PAGE_NAME) {\n    // 未登陆且要跳转的页面是登录页\n    next(); // 跳转\n  } else if (token && to.name === LOGIN_PAGE_NAME) {\n    // 已登录且要跳转的页面是登录页\n    next({\n      name: homeName // 跳转到homeName页\n\n    });\n  } else {\n    if (store.state.user.hasGetInfo) {\n      turnTo(to, store.state.user.access, next);\n    } else {\n      store.dispatch('getUserInfo').then(function (user) {\n        // 拉取用户信息，通过用户权限和跳转的页面的name来判断是否有权限访问;access必须是一个数组，如：['super_admin'] ['super_admin', 'admin']\n        turnTo(to, user.access, next);\n      }).catch(function () {\n        setToken('');\n        next({\n          name: 'login'\n        });\n      });\n    }\n  }\n});\nrouter.afterEach(function (to) {\n  setTitle(to, router.app);\n  iView.LoadingBar.finish();\n  window.scrollTo(0, 0);\n});\nexport default router;",null]}